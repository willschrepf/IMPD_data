---
title: "Indianapolis Metro Police Department Use of Force Data"
author: "Will Schrepferman"
date: "6/1/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, include = FALSE)
library(tidyverse)
library(dplyr)
library(janitor)
library(gt)
```

## Introduction

This project uses public data to analyze the Indiana Metro Police Department's use of force since 2014. I used data from the OpenIndy Data Portal, part of Mayor Joe Hogsett's 'Disclose Indy' initative to ensure public access to Indianapolis' public records. No law requires the disclosure of police data across the state of Indiana as a whole (even though state law requires police departments to be open with their data), but this shortcoming will be discussed later.

## Data Cleaning

Specifically, I used the following source: http://data.indy.gov/datasets/impd-complaints/data.

A few notes on structural changes I made to filter data: I downloaded the data directly from the site, but had to reformat it and remove duplicate rows, as it appears multiple reports were sometimes filed about the same instance (I reached out to OpenIndy and the IMPD to get clarification on this, but I'll leave the data as is until I receive information proving my theory wrong). Also, it appears that every type of force is counted as an instance- for example, if the same officer uses both a taser and physical pressure on the same citizen, that is logged as two separate instances. I kept this structural organization of the data, as I feel it is critical to include every instance that officers saw fit to log.

I also re-named several columns in order to more directly convey their meaning. All told, there are 21,893 relevant instances in the data, which range from the beginning of 2014 to May 27, 2020 (I downloaded the data on June 1). Each instance has information on: the date, IMPD division, district, disposition, street number and name, type of force used, reason for use of force, circumstances of the officer's involvement (service), details on the arrest, injury, or hospitalization of the citizen, injury or hospitalization of the officer,  demographic information on both parties, and the officer's ID number.

```{r read_data}
raw_data <- read.csv("IMPD_Use_Of_Force.csv") %>%
  clean_names()
  
# rename columns and change data types
  
clean_data <- raw_data %>%
  mutate(incident_num = incnum) %>%
  mutate(date = as.Date(occurred_dt)) %>%
  mutate(division = as.character(udtext24a)) %>%
  mutate(district = as.character(udtext24b)) %>%
  mutate(disposition = as.character(disposition)) %>%
  mutate(street_num = as.numeric(street_n)) %>%
  mutate(street_name = as.character(street)) %>%
  mutate(type_of_force = as.character(uof_force_type)) %>%
  mutate(reason_for_force = as.character(uof_reason)) %>%
  mutate(service = as.character(service_type)) %>%
  mutate(citizen_arrested = as.character(cit_arrested)) %>%
  mutate(citizen_weapon = as.character(cit_weapon_type)) %>%
  mutate(citizen_injured = as.character(cit_injured)) %>%
  mutate(citizen_hospitalized = as.character(cit_hospital)) %>%
  mutate(officer_injured = as.character(off_injured)) %>%
  mutate(officer_hospitalized = as.character(off_hospital)) %>%
  mutate(citizen_race = as.character(race)) %>%
  mutate(citizen_sex = as.character(sex)) %>%
  mutate(officer_number = as.character(offnum)) %>%
  mutate(officer_race = as.character(off_race)) %>%
  mutate(officer_sex = as.character(off_sex)) %>%
  mutate(officer_age = as.character(off_age)) %>%
  mutate(officer_years_employed = as.numeric(off_yr_employ)) %>%
  select(incident_num, date, division, district, disposition, street_num, street_name, type_of_force, reason_for_force, service,
         citizen_arrested, citizen_weapon, citizen_injured, citizen_hospitalized, officer_injured, officer_hospitalized, citizen_race,
         citizen_sex, officer_number, officer_race, officer_sex, officer_age, officer_years_employed)

# remove duplicate rows

clean_data <- unique(clean_data) 

```

Here is a sample of rows from the data:

```{r display_data, include = TRUE}
clean_data %>%
  head(5) %>%
  gt()
```

## Overview

First 
https://citybase-cms-prod.s3.amazonaws.com/d95654f9a1234d87afd0724cc65172c9.pdf
```{r impd_demo_bar}
impd_demo_data <- tibble(race = c("Asian", "Hispanic", "Black", "White"), percent = c(0.1, 3.0, 16.0, 79.6))
impd_demo_bar <- impd_demo_data %>%
  ggplot(aes(x = reorder(race, percent), y = percent, fill = c("cadetblue1", "lightcoral", "khaki", "lightgreen"))) +
  geom_bar(stat = "identity") +
  theme(legend.position = "onenone") +
  ylim(0, 85) +
  geom_text(aes(label=percent), hjust=-0.15, size=3.5) + 
  labs(x = "Race", y = "Percent of IMPD Force") +
  coord_flip()
# TODO: Fix colors
```

```{r indy_demo_bar, include = TRUE}
indy_demo_data <- tibble(race = c("Asian", "Black", "Hispanic", "White"), percent = c(3.2, 28.3, 10.2, 61.4))
indy_demo_bar <- indy_demo_data %>%
  ggplot(aes(x = reorder(race, percent), y = percent, fill = c("cadetblue1", "lightcoral", "khaki", "lightgreen"))) +
  geom_bar(stat = "identity") +
  theme(legend.position = "onenone") +
  geom_text(aes(label=percent), hjust=-0.15, size=3.5) + 
  ylim(0, 85) +
  labs(x = "Race", y = "Percent of Indianapolis Population") +
  coord_flip()
```


```{r indy_demo_pie, include = TRUE}
indy_race_data <- tibble(race = c("Asian", "Black", "Hispanic", "White"), percent = c(3.2, 28.3, 10.2, 61.4))
pct <- round(indy_race_data$percent/sum(indy_race_data$percent)*100, 1)
indy_race_data$race <- paste(indy_race_data$race, pct) # add percents to labels
indy_race_data$race <- paste(indy_race_data$race,"%",sep="") # ad % to labels
pie(indy_race_data$percent,labels = indy_race_data$race, col=c("cadetblue1", "lightcoral", "khaki", "lightgreen"),
   main="Indianapolis Demographics") 
```
https://www.census.gov/quickfacts/fact/table/indianapoliscitybalanceindiana/PST045219#qf-headnote-a


```{r use_of_force_demo_pie, include = TRUE}

race_overview <- clean_data %>%
  group_by(citizen_race) %>%
  summarize(count = n()) %>%
  filter(citizen_race == "Asian" | citizen_race == "Black" | citizen_race == "Hispanic" | citizen_race == "White")

pct <- round(race_overview$count/sum(race_overview$count)*100, 1)
race_overview$citizen_race <- paste(race_overview$citizen_race, pct) # add percents to labels
race_overview$citizen_race <- paste(race_overview$citizen_race,"%",sep="") # ad % to labels
pie(race_overview$count,labels = race_overview$citizen_race, col=c("cadetblue1", "lightcoral", "khaki", "lightgreen"),
   main="IMPD Uses of Force") 
```


```{r types_of_force, include = TRUE}
use_of_force_chart <- clean_data %>%
  filter(type_of_force != "") %>%
  group_by(type_of_force) %>%
  summarize(count = n(), na.rm = TRUE) %>%
  ggplot(aes(x = reorder(type_of_force, count), y = count)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(x = "Type of Force Used", y = "Count", title = "IMPD Uses of Force by Type")

#508 instances where type not reported
```

```{r use_of_force}
uof_data <- clean_data %>%
  filter(type_of_force != "") %>%
  group_by(type_of_force) %>%
  summarize(count = n(), na.rm = TRUE) %>%
  arrange(-count)

#for(i in 1:43){
#  type <- uof_data[i, 1] %>%
#    slice(1) %>%
#    pull(1)
#  count <- uof_data[i, 2] %>%
#    slice(1) %>%
#    pull(1)
#  
#  specific_pie_data <- clean_data %>%
#  filter(type_of_force == type) %>%
#  group_by(citizen_race) %>%
#  summarize(count = n()) %>%
#  filter(citizen_race == "Asian" | citizen_race == "Black" | citizen_race == "Hispanic" | citizen_race == "White")
#
#  pct <- round(specific_pie_data$count/sum(specific_pie_data$count)*100, 1)
#  specific_pie_data$citizen_race <- paste(specific_pie_data$citizen_race, pct) # add percents to labels
#  specific_pie_data$citizen_race <- paste(specific_pie_data$citizen_race,"%",sep="") # ad % to labels
#  pie(specific_pie_data$count,labels = specific_pie_data$citizen_race, col = rainbow(length(specific_pie_data$citizen_race)),
#  main=paste("Racial Breakdown: ", type, " (", count, " instances)", sep = "")) 
#}


for(i in 1:43){
  type <- uof_data[i, 1] %>%
    slice(1) %>%
    pull(1)
  count <- uof_data[i, 2] %>%
    slice(1) %>%
    pull(1)
  
  specific_data <- clean_data %>%
    filter(type_of_force == type) %>%
    group_by(citizen_race) %>%
    summarize(count = n()) %>%
    filter(citizen_race == "Black" | citizen_race == "White" | citizen_race == "Asian" | citizen_race == "Hispanic")

  asian_add <- c("Asian", 0)
  black_add <- c("Black", 0)
  hispanic_add <- c("Hispanic", 0)
  white_add <- c("White", 0)
  
  
  if(length(specific_data$citizen_race) == 4){
    new_data <- specific_data
  }
  else if ("Asian" %in% specific_data$citizen_race == FALSE){
    new_data <- rbind(specific_data, asian_add)
  }
  else if ("Black" %in% specific_data$citizen_race == FALSE){
    new_data <- rbind(specific_data, black_add)
  }
  else if ("Hispanic" %in% specific_data$citizen_race == FALSE){
    new_data <- rbind(specific_data, hispanic_add)
  }
  else if ("White" %in% specific_data$citizen_race == FALSE){
    new_data <- rbind(specific_data, white_add)
  }
  
  max <- new_data %>%
    arrange(-as.numeric(count)) %>%
    slice(1) %>%
    pull(2)
  
  graph <- new_data %>%
    ggplot(aes(x = citizen_race, y = as.numeric(count), fill = citizen_race)) +
    geom_bar(stat = "identity") +
    labs(title = paste("Racial Breakdown for Force Type: ", type, " (", count, " instances)", sep = ""), x = "Citizen Race", y = "Count") +
    ylim(0, max)
  
  print(graph)
}

```



```{r data_analysis}
officer_years <- clean_data %>%
  group_by(officer_number) %>%
  select(officer_number, officer_years_employed)

officers <- clean_data %>%
  group_by(officer_number) %>%
  summarize(uses_of_force = n()) %>%
  arrange(-uses_of_force)

clean_data %>%
  filter(officer_number == 1814) %>%
  arrange(desc(date))


clean_data %>%
  group_by(type_of_force) %>%
  summarize(count = n())


lethal_data <- clean_data %>%
  filter(type_of_force == "Lethal-Handgun" | type_of_force == "Lethal-Knife" | type_of_force == "Lethal-Vehicle")

lethal_data %>%
  group_by(officer_number) %>%
  summarize(count = n()) %>%
  arrange(-count)

offcier_3472 <- clean_data %>%
  filter(officer_number == 3472)
```


